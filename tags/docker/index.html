<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>docker | zibuyu28</title><meta name=keywords content><meta name=description content="zibuyu28's blog"><meta name=author content="zibuyu28"><link rel=canonical href=https://zibuyu28.github.io/tags/docker/><meta name=google-site-verification content="XYZabc"><meta name=yandex-verification content="XYZabc"><meta name=msvalidate.01 content="XYZabc"><link crossorigin=anonymous href=/assets/css/stylesheet.bc1149f4a72aa4858d3a9f71462f75e5884ffe8073ea9d6d5761d5663d651e20.css integrity="sha256-vBFJ9KcqpIWNOp9xRi915YhP/oBz6p1tV2HVZj1lHiA=" rel="preload stylesheet" as=style><link rel=icon href=https://zibuyu28.github.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://zibuyu28.github.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://zibuyu28.github.io/favicon-32x32.png><link rel=apple-touch-icon href=https://zibuyu28.github.io/%3Clink%20/%20abs%20url%3E><link rel=mask-icon href=https://zibuyu28.github.io/%3Clink%20/%20abs%20url%3E><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate type=application/rss+xml href=https://zibuyu28.github.io/tags/docker/index.xml><noscript><style>#theme-toggle,.top-link{display:none}</style></noscript><script type=application/javascript>var doNotTrack=!1;doNotTrack||(function(e,t,n,s,o,i,a){e.GoogleAnalyticsObject=o,e[o]=e[o]||function(){(e[o].q=e[o].q||[]).push(arguments)},e[o].l=1*new Date,i=t.createElement(n),a=t.getElementsByTagName(n)[0],i.async=1,i.src=s,a.parentNode.insertBefore(i,a)}(window,document,"script","https://www.google-analytics.com/analytics.js","ga"),ga("create","UA-123-45","auto"),ga("send","pageview"))</script><meta property="og:title" content="docker"><meta property="og:description" content="zibuyu28's blog"><meta property="og:type" content="website"><meta property="og:url" content="https://zibuyu28.github.io/tags/docker/"><meta property="og:image" content="https://zibuyu28.github.io/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta property="og:site_name" content="zibuyu28"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://zibuyu28.github.io/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta name=twitter:title content="docker"><meta name=twitter:description content="zibuyu28's blog"></head><body class=list id=top><script>localStorage.getItem("pref-theme")==="dark"&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://zibuyu28.github.io accesskey=h title="gopher zby (Alt + H)"><img src=https://zibuyu28.github.io/apple-touch-icon.png alt aria-label=logo height=35>gopher zby</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://zibuyu28.github.io/categories/ title=分类><span>分类</span></a></li><li><a href=https://zibuyu28.github.io title=notme><span>notme</span></a></li><li><a href=https://zibuyu28.github.io/tags/ title=标签><span>标签</span></a></li></ul></nav></header><main class=main><header class=page-header><div class=breadcrumbs><a href=https://zibuyu28.github.io>Home</a>&nbsp;»&nbsp;<a href=https://zibuyu28.github.io/tags/>Tags</a></div><h1>docker
<a href=index.xml title=RSS aria-label=RSS><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" height="23"><path d="M4 11a9 9 0 019 9"/><path d="M4 4a16 16 0 0116 16"/><circle cx="5" cy="19" r="1"/></svg></a></h1></header><article class="post-entry tag-entry"><header class=entry-header><h2>Docker 基础知识</h2></header><div class=entry-content><p>docker 容器的本质是进程
一张图理解容器和虚拟机的区别 对比这两张图可以发现第二张图更为准确，因为docker engine只是一个服务工具而已，所有的容器进程还是运行在宿主机上的 docker 如何实现隔离 我们知道docker容器内部看到的pid和宿主机的pid是相互隔离的，这个是通过 Linux 的 Namespace 技术实现的 当系统调用 clone 方法创建进程的时候，增加了一个 CLONE_NEWPID 参数，这样创建的进程就会"看到"一个全新的空间，这样当前进程的 pid 就是 1，但是在宿主机上这个进程的pid是真实的pid（比如100） 上述的就是 PID Namespace，类似的还有Mount，UTS，IPC，Network，User这些Namespace，都是类似"障眼法"的功能 docker 如何实现限制 因为所有的容器进程都是运行在宿主机上的，所以各个容器都是共用宿主机操作系统内核的，包括cpu，内存等资源 使用Linux的Cgroup功能来限制进程的资源使用。Linux Cgroups 的全称是 Linux Control Group。它最主要的作用，就是限制一个进程组能够使用的资源上限，包括 CPU、内存、磁盘、网络带宽等等 容器是一个"单进程"模型 docker 如何实现文件读写 容器内目录文件需要通过Mount Namespace来进行隔离， Mount Namespace 修改的，是容器进程对文件系统"挂载点"的认知 通过Mount Namespace 可以改变进行对 “/” 目录的认知，即改变进程的根文件系统 （change root file system） 而这个挂载在容器根目录上、用来为容器进程提供隔离后执行环境的文件系统，就是所谓的"容器镜像"。它还有一个更为专业的名字，叫作：rootfs（根文件系统）。 rootfs 只是一个操作系统所包含的文件、配置和目录，并不包括操作系统内核。所以说，rootfs 只包括了操作系统的"躯壳"，并没有包括操作系统的"灵魂" docker 常见容器的基本步骤 启动Linux Namespace 配置 设置指定的 Cgroups 参数 切换进程的根目录（Change root） docker 镜像来解决每次启动容器都需要拷贝 rootfs 文件的问题 docker的镜像设计引入了层（layer）的概念，也就是用户制作镜像的每一步骤都是一层，都是增量的rootfs 那每一层都会有不通的东西和相同的东西，这些东西怎么从层（垂直结构）的概念到最后的 目录结构（水平结构）的呢 联合文件系统（UnionFS）来解决这个问题，比如又两个文件A，B $ tree ....</p></div><footer class=entry-footer><span title='2022-10-09 12:21:41 +0800 CST'>2022-10-09</span>&nbsp;·&nbsp;1 min&nbsp;·&nbsp;188 words&nbsp;·&nbsp;zibuyu28</footer><a class=entry-link aria-label="post link to Docker 基础知识" href=https://zibuyu28.github.io/post/docker/></a></article><article class="post-entry tag-entry"><header class=entry-header><h2>本地如何直连kubernetes环境</h2></header><div class=entry-content><p>0. 由来 本地开发可以在本机搭建solo环境（各种依赖服务） 但是在本地资源比较紧张的时候，就会在开发主机上使用docker部署的微服务系统 docker部署方式会将各个微服务的服务端口开放置宿主机 服务内注册的地址形式 {宿主机ip:映射端口} 本地开发环境可以直连开发主机上的微服务 当测试在测试环境（kubernetes环境）测试，出现问题之后找bug本地无法直连测试环境，只能依靠日志（需要添加日志重新部署） 希望可以在本地直接连接kubernetes环境 1. 了解网络 容器网络 本地启动docker之后，会有一个docker0网卡，容器内会有一个eth0网卡，但是这两个网卡是不同的，有一个虚拟设备veth-pair，这就类似一根网线一端插在容器内的网卡，一端插在docker0网卡，这样就实现了容器和宿主机的互通 本地启动docker之后可以看到一个docker0网卡，及路由信息 ➜ ~ route Kernel IP routing table Destination Gateway Genmask Flags Metric Ref Use Iface default gateway 0.0.0.0 UG 100 0 0 eth0 172.17.0.0 0.0.0.0 255.255.0.0 U 0 0 0 docker0 172.19.0.0 0.0.0.0 255.255.0.0 U 0 0 0 br-efd21faa9c32 172.20.0.0 0.0.0.0 255.255.0.0 U 0 0 0 br-2696f6e7def3 172.21.0.0 0.0.0.0 255.255.0.0 U 0 0 0 br-d27e3bb7d16b 172....</p></div><footer class=entry-footer><span title='2022-09-25 22:50:43 +0800 CST'>2022-09-25</span>&nbsp;·&nbsp;3 min&nbsp;·&nbsp;511 words&nbsp;·&nbsp;zibuyu28</footer><a class=entry-link aria-label="post link to 本地如何直连kubernetes环境" href=https://zibuyu28.github.io/post/first-post/></a></article></main><footer class=footer><span>&copy; 2022 <a href=https://zibuyu28.github.io>zibuyu28</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>